// dna.js v1.4.3 ~~ dnajs.org ~~ MIT
var dna={clone:function(e,n,a){var t=$.extend({fade:!1,top:!1,container:null,empty:!1,clones:1,html:!1,transform:null,callback:null},a),d=dna.store.getTemplate(e);d.nested&&!t.container&&dna.core.berserk("Container missing for nested template: "+e),t.empty&&dna.empty(e);for(var o=[];t.clones--;)o=o.concat(n);var r=$();$.each(o,function(e,n){r=r.add(dna.core.replicate(d,n,e,t))}),dna.placeholder.setup();var i=r.first();return i.closest(".dna-menu, .dna-panels").each(dna.panels.refresh),i.parents(".dna-hide").removeClass("dna-hide").addClass("dna-unhide"),r},cloneSub:function(e,n,a,t){var d=dna.compile.subTemplateName(e,n),o=".dna-contains-"+d,r={container:e.find(o).addBack(o)};dna.clone(d,a,$.extend(r,t));var i=dna.getModel(e)[n];return $.each(a instanceof Array?a:[a],function(e,n){i.push(n)}),e},createTemplate:function(e,n,a){return $(n).attr({id:e}).addClass("dna-template").appendTo(a),dna.store.getTemplate(e)},rest:{get:function(n,e,a){return $.getJSON(e,function(e){e.error||dna.clone(n,e,a)})}},getModel:function(e,n){return(e instanceof $?function(e){return dna.getClone(e,n).data("dnaModel")}:function(e){var a=[];return dna.getClones(e).each(function(e,n){a.push(dna.getModel($(n)))}),a})(e)},empty:function(e,n){var a=$.extend({fade:!1},n),t=dna.store.getTemplate(e),d=t.container.find(".dna-clone");return t.container.data().dnaCountsMap&&(t.container.data().dnaCountsMap[e]=0),a.fade?dna.ui.slideFadeDelete(d):dna.core.remove(d)},insert:function(e,n,a){var t=dna.getClones(e).first();return t.length?dna.refresh(t,{data:n,html:a&&a.html}):dna.clone(e,n,a)},refresh:function(e,n){var a=$.extend({html:!1},n),t=dna.getClone(e,n),d=a.data?a.data:dna.getModel(t);return dna.core.inject(t,d,t.data().dnaCount,a)},refreshAll:function(e){return dna.getClones(e).each(function(e,n){dna.refresh($(n))})},destroy:function(e,n){var a,t=$.extend({fade:!1},n);return(e=dna.getClone(e,n)).hasClass("dna-sub-clone")&&(a=e.data().dnaRules.array,dna.getModel(e.parent())[a].splice(dna.getIndex(e),1)),t.fade?dna.ui.slideFadeDelete(e):dna.core.remove(e)},getClone:function(e,n){var a=$.extend({main:!1},n).main?".dna-clone:not(.dna-sub-clone)":".dna-clone";return e instanceof $?e.closest(a):$()},getClones:function(e){return dna.store.getTemplate(e).container.children(".dna-clone."+e)},getIndex:function(e,n){var a=dna.getClone(e,n);return a.parent().children(".dna-clone."+a.data().dnaRules.template).index(a)},up:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!0)},down:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!1)},bye:function(e){return dna.destroy(dna.ui.toElem(e,this),{fade:!0})},registerInitializer:function(e,n){var a=$.extend({onDocumentLoad:!0},n);return a.onDocumentLoad&&dna.util.apply(e,[a.selector?$(a.selector).not(".dna-template "+a.selector).addClass("dna-initialized"):$(window.document)].concat(a.params)),dna.events.initializers.push({func:e,selector:a.selector,params:a.params})},clearInitializers:function(){dna.events.initializers=[]},registerContext:function(e,n){return dna.events.context[e]=n,dna.events.context},info:function(){var e=Object.keys(dna.store.templates);return{version:"1.4.3",templates:e.length,clones:$(".dna-clone:not(.dna-sub-clone)").length,subs:$(".dna-sub-clone").length,names:e,store:dna.store.templates,initializers:dna.events.initializers}}};dna.array={find:function(e,n,a){a=a||"code";var t=Array.isArray(e),d=0;if(t)for(;d<e.length&&e[d][a]!==n;)d++;return t&&d<e.length?{item:e[d],index:d}:{item:void 0,index:-1}},last:function(e){return Array.isArray(e)&&e.length?e[e.length-1]:void 0},fromMap:function(e,n){var a,t=$.extend({key:"code",kebabCodes:!1},n),d=[];for(var o in e)d[d.push((a=e[o],a instanceof Object?a:{value:a}))-1][t.key]=t.kebabCodes?dna.util.toKebab(o):o;return d},toMap:function(e,n){var a=$.extend({key:"code",camelKeys:!1},n),t={};return e.forEach(a.camelKeys?function(e){t[dna.util.toCamel(e[a.key])]=e}:function(e){t[e[a.key]]=e}),t}},dna.browser={getUrlParams:function(){var n={};return window.location.search.slice(1).split("&").forEach(function(e){e&&(n[e.split("=")[0]]=e.split("=")[1])}),n},iOS:function(){return/iPad|iPhone|iPod/.test(window.navigator.userAgent)&&/Apple/.test(window.navigator.vendor)}},dna.browser.getParams=dna.browser.getUrlParams,dna.pageToken={put:function(e,n){return window.sessionStorage[e+window.location.pathname]=JSON.stringify(n),n},get:function(e,n){var a=window.sessionStorage[e+window.location.pathname];return void 0===a?n:JSON.parse(a)}},dna.ui={deleteElem:function(e){var n=dna.ui.toElem(e,this);return dna.core.remove(n),n},focus:function(e){return e.focus()},getComponent:function(e){return e.closest("[data-component]")},pulse:function(e,n){var a=$.extend({duration:400,interval:null,out:5e3},n),t={opacity:0},d={opacity:1};return e.stop(!0).slideDown().css(t).animate(d,a.duration),a.interval&&e.animate(d,a.interval).animate(t,a.out),e},slideFade:function(e,n,a){var t={transition:"opacity 0s"};return window.setTimeout(function(){e.css(t)},1e3),a?e.css({opacity:0,transition:"opacity 0s"}).hide().slideDown({complete:n}).css({opacity:1,transition:"opacity 0.4s"}):e.css({opacity:0,transition:"opacity 0.4s"}).slideUp({complete:n}),e},slideFadeIn:function(e,n){return dna.ui.slideFade(e,n,!0)},slideFadeOut:function(e,n){return dna.ui.slideFade(e,n,!1)},slideFadeToggle:function(e,n){return dna.ui.slideFade(e,n,e.is(":hidden"))},slideFadeDelete:function(e){return dna.ui.slideFadeOut(e,dna.ui.deleteElem)},slidingFlasher:function(e){return dna.ui.pulse(e)},smoothHeightSetBaseline:function(e){dna.ui.$container=e=e||$("body");var n=e.outerHeight();return e.css({minHeight:n,maxHeight:n,overflow:"hidden"})},smoothHeightAnimate:function(e,n){return n=n||dna.ui.$container,window.setTimeout(function(){n.css({minHeight:0,maxHeight:"100vh"}),window.setTimeout(function(){n.css({transition:"none",maxHeight:"none"})},1e3)},e||50),window.setTimeout(function(){n.css({transition:"all 1s"})},10),n},smoothMove:function(e,n){var a,t=n?e.prev():e.next();return t.length&&(a=t.clone(),n?e.after(t.hide()).before(a):e.before(t.hide()).after(a),dna.ui.slideFadeIn(t),dna.ui.slideFadeDelete(a)),e},toElem:function(e,n){return e instanceof $?e:$(e?e.target:n)}},dna.util={apply:function(t,e){var d,o=void 0===e?[]:[].concat(e),r=o[0];return r instanceof $&&0===r.length?d=r:"function"==typeof t?d=t.apply(r,o):r&&r[t]?d=r[t](o[1],o[2],o[3]):""===t||{number:!0,boolean:!0}[typeof t]?dna.core.berserk("Invalid callback function: "+t):"string"==typeof t&&0<t.length&&function(e){r instanceof $&&o.push(dna.ui.getComponent(r));var n=e[0],a=eval;void 0===window[n]&&!dna.events.context[n]&&/^[_$a-zA-Z][_$a-zA-Z0-9]*$/.test(n)&&"object"===a("typeof "+n)&&dna.registerContext(n,a(n)),function e(n,a){!n||1===a.length&&"function"!=typeof n[a[0]]?dna.core.berserk("Callback function not found: "+t):1===a.length?d=n[a[0]].apply(r,o):e(n[a[0]],a.slice(1))}(dna.events.context[n]?dna.events.context:window,e)}(t.split(".")),d},assign:function(e,n,a){"string"==typeof n&&(n=n.split("."));var t=n[0];return $.isPlainObject(e)||(e={}),1===n.length?e[t]=a:dna.util.assign(void 0===e[t]?e[t]={}:e[t],n.slice(1),a),e},printf:function(e){return Array.prototype.slice.call(arguments,1).reduce(function(e,n){return e.replace(/%s/,n)},e)},realTruth:function(e){return!!e&&!(e instanceof Array&&0===e.length||/^(f|false|0)$/i.test(e))},toCamel:function(e){return(""+e).replace(/\-(.)/g,function(e,n){return n.toUpperCase()})},toKebab:function(e){return(""+e).replace(/([A-Z]+)/g,function(e){return"-"+e.toLowerCase()}).replace(/\s|^-/g,"")},value:function(e,n){return"string"==typeof n&&(n=n.split(".")),null==e||void 0===n?null:1===n.length?e[n[0]]:dna.util.value(e[n[0]],n.slice(1))}},dna.placeholder={setup:function(){$("option.dna-template").closest("select").addClass("dna-hide"),$("[data-placeholder]").each(function(e,n){var a=$(n).stop(!0);return dna.getClones(a.data().placeholder).length?a.fadeOut():a.fadeIn()})}},dna.panels={display:function(e,n,a){var t,d=e.data().dnaKey,o=e.find(".menu-item");void 0===n&&(n=dna.pageToken.get(d,0)),n=Math.max(0,Math.min(n,o.length-1)),e[0].selectedIndex=n,o.removeClass("selected").addClass("unselected").eq(n).addClass("selected").removeClass("unselected");var r=(t=$(d).children().hide().removeClass("displayed").addClass("hidden").eq(n).fadeIn().addClass("displayed").removeClass("hidden")).data().hash;dna.pageToken.put(d,n),a&&r&&window.history.pushState(null,null,"#"+r),dna.util.apply(e.data().callback,[t,r])},clickRotate:function(e){var n=$(e.target).closest(".menu-item"),a=n.closest(".dna-menu");dna.panels.display(a,a.find(".menu-item").index(n),!0)},selectRotate:function(e){var n=$(e.target);dna.panels.display(n,n.find("option:selected").index(),!0)},reload:function(e){dna.panels.display($("#"+e))},refresh:function(e,n){var a=$(n);a.hasClass("dna-panels")&&(a=$("#"+a.attr("id").replace(/-panels$/,"")+"-menu")),!a.length&&$(n).hasClass("dna-panels")&&(a=$("#"+a.attr("id").replace(/-panels$/,"")));var t,d=window.location.hash.slice(1),o=a.data().dnaKey="#"+a.attr("id").replace(/-menu$/,"")+"-panels",r=$(o).children().addClass("panel");function i(e){return 0<e.first().closest(".dna-template").length}0===a.find(".menu-item").length&&a.children().addClass("menu-item"),i(r)||i(a.children())||dna.panels.display(a,(t=r,d&&t.first().data().hash?t.filter("[data-hash="+d+"]").index():dna.pageToken.get(o,0)))},setup:function(){$(".dna-menu").each(dna.panels.refresh),$(window.document).on({click:dna.panels.clickRotate},".dna-menu .menu-item"),$(window.document).on({change:dna.panels.selectRotate},".dna-menu")}},dna.compile={regexDnaField:/^[\s]*(~~|\{\{).*(~~|\}\})[\s]*$/,regexDnaBasePair:/~~|{{|}}/,regexDnaBasePairs:/~~|\{\{|\}\}/g,setupNucleotide:function(e){return void 0===e.data().dnaRules&&(e.data().dnaRules={}),e.addClass("dna-nucleotide")},isDnaField:function(e,n){var a=n.childNodes[0];return a&&a.nodeValue&&a.nodeValue.match(dna.compile.regexDnaField)},field:function(e,n){return(n=dna.compile.setupNucleotide($(n))).data().dnaField=$.trim(n.text()).replace(dna.compile.regexDnaBasePairs,""),n.is("textarea")?n.addClass("dna-update-model").data().dnaRules.val=!0:n.data().dnaRules.text=!0,n.empty()},propsAndAttrs:function(e,i){i=$(i);var l=[],s=[],u=[];return $.each(i.get(0).attributes,function(e,n){var a,t,d,o,r;/^data-prop-/.test(n.name)?(o=n.name,r=n.value,u.push(o),o=o.replace(/^data-prop-/,"").toLowerCase(),r=r.replace(dna.compile.regexDnaBasePairs,""),l.push(o,r),"checked"===o&&i.is("input")&&(i.addClass("dna-update-model").data().dnaField=r)):3===n.value.split(dna.compile.regexDnaBasePair).length&&(a=n.name,t=n.value,"[count]"===(d=t.split(dna.compile.regexDnaBasePair))[1]?d[1]=1:"[value]"===d[1]&&(d[1]=2),s.push(a.replace(/^data-attr-/,""),d),u.push(a),(i.is("input:not(:checkbox, :radio)")&&"value"===a&&""===d[0]&&""===d[2]||i.is("select")&&"data-option"===a)&&(dna.compile.setupNucleotide(i).addClass("dna-update-model"),i.data().dnaField=d[1],i.data().dnaRules.val=!0))}),0<l.length&&(dna.compile.setupNucleotide(i).data().dnaRules.props=l),0<s.length&&(dna.compile.setupNucleotide(i).data().dnaRules.attrs=s),i.data().transform&&(dna.compile.setupNucleotide(i).data().dnaRules.transform=i.data().transform),i.data().callback&&(dna.compile.setupNucleotide(i).data().dnaRules.callback=i.data().callback),i.removeAttr(u.join(" "))},getDataField:function(e,n){return $.trim(e.data(n).replace(dna.compile.regexDnaBasePairs,""))},subTemplateName:function(e,n){return(e instanceof $?dna.getClone(e).data().dnaRules.template:e)+"-"+n+"-instance"},rules:function(e,t,d){return e.filter("[data-"+t+"]").each(function(e,n){n=dna.compile.setupNucleotide($(n));var a=dna.compile.getDataField(n,t);n.data().dnaRules[t]=d?a.split(","):a}).removeAttr("data-"+t)},separators:function(e){function t(e,n){return 3===n.nodeType&&!/\S/.test(n.nodeValue)}function d(e,n,a){n&&(e.contents().last().filter(t).remove(),e.append($("<span>").addClass(a).html(n)))}e.find(".dna-template, .dna-sub-clone").addBack().each(function(e,n){var a=$(n);d(a,a.data().separator,"dna-separator"),d(a,a.data().lastSeparator,"dna-last-separator")})},template:function(e){var n=$("#"+e);n.length||dna.core.berserk("Template not found: "+e),n.find(".dna-template").addBack().each(function(e,n){$(n).data().dnaRules={template:$(n).attr("id")}}).removeAttr("id");var d=n.find("*").addBack();function a(a,t){d.filter("[data-"+a+"]").each(function(e,n){$(n).attr("data-"+t,$(n).data(a))}).removeAttr("data-"+a)}return a("truthy","true"),a("falsey","false"),d.filter(dna.compile.isDnaField).each(dna.compile.field),dna.compile.rules(d,"array").addClass("dna-sub-clone"),dna.compile.rules(d,"class",!0),dna.compile.rules(d,"require"),dna.compile.rules(d,"missing"),dna.compile.rules(d,"true"),dna.compile.rules(d,"false"),d.each(dna.compile.propsAndAttrs),dna.compile.separators(n),$("input[data-attr-type]").each(function(e,n){$(n).attr({type:$(n).data().attrType})}),dna.store.stash(n)}},dna.store={templates:{},stash:function(e){var d=e.data().dnaRules.template;function n(e,n){var a=(n=$(n)).data().dnaRules.template,t=n.parent(),d=1===t.children().length&&!t.hasClass("dna-container");d||t.data().dnaContents||(t.data().dnaContents=!0,t.data().dnaContents=t.children().toArray().map(function(e){return(e=$(e)).hasClass("dna-template")?(n=e.attr("id"))?dna.compile.template(n).name:a:!!e.hasClass("dna-sub-clone")&&e.data().dnaRules.template;var n}));var o={name:a,elem:n,container:t.addClass("dna-container").addClass("dna-contains-"+a),nested:0!==t.closest(".dna-clone").length,separators:n.find(".dna-separator, .dna-last-separator").length,wrapped:d};dna.store.templates[a]=o,n.removeClass("dna-template").addClass("dna-clone").addClass(a).detach()}return e.find(".dna-template").addBack().each(n),e.find(".dna-sub-clone").each(function(e,n){var a=(n=$(n)).data().dnaRules.array,t=dna.compile.subTemplateName(d,a);dna.compile.setupNucleotide(n.parent().addClass("dna-array")).data().dnaRules.loop={name:t,field:a},n.data().dnaRules.template=t}).each(n),dna.store.templates[d]},getTemplate:function(e){return dna.store.templates[e]||dna.compile.template(e)}},dna.events={context:{},initializers:[],runOnLoads:function(){return $("[data-on-load]").not(".dna-loaded").each(function(e,n){dna.util.apply($(n).data().onLoad,$(n))}).addClass("dna-loaded")},runInitializers:function(t){return $.each(dna.events.initializers,function(e,n){var a=n.selector?t.find(n.selector).addBack(n.selector):t;dna.util.apply(n.func,[a.addClass("dna-initialized")].concat(n.params))}),t},setup:function(){function i(e,n,a){var t=(e=e.closest("[data-"+n+"]")).data(n);return"click"===n&&"A"===e.prop("tagName")&&t&&t.match(/^dna[.]/)&&a.preventDefault(),dna.util.apply(t,[e,a])}function e(e){var n,a=$(e.target);function t(e,n){dna.util.assign(dna.getModel(e),e.data().dnaField,n(e))}function d(e){return e.val()}function o(e){return e.is(":checked")}function r(e,n){t($(n),o)}return a.hasClass("dna-update-model")&&(0!==(n=dna.getClone(a,{main:!0})).length&&(a.is("input:checkbox")?t(a,o):a.is("input:radio")?$("input:radio[name="+a.attr("name")+"]").each(r):a.data().dnaRules.val&&t(a,d),dna.refresh(n))),i(a,e.type.replace("key","key-"),e)}function n(a){var t=$(a.target),d=t.data();d.smartUpdate&&function(){function e(){d.dnaLastUpdated=Date.now(),d.dnaTimeoutId=void 0,i(t,"smart-update",a)}var n;"keydown"===a.type&&void 0===d.dnaLastValue&&(d.dnaLastValue=t.val()),"keydown"!==a.type&&t.val()!==d.dnaLastValue&&(n=d.smartThrottle?+d.smartThrottle:1e3,d.dnaLastValue=t.val(),d.dnaTimeoutId||(Date.now()<d.dnaLastUpdated+n?d.dnaTimeoutId=window.setTimeout(e,n):e()))}()}$(window.document).click(e).change(e).keyup(e).keyup(function(e){13===e.which&&i($(e.target),"enter-key",e)}).keydown(e).keypress(e).keydown(n).keyup(n).change(n).on({input:e}).on({click:function(e){var n=$(e.target),a=!dna.browser.iOS()&&n.closest(".external-site").length;window.open(n.closest("[data-href]").data().href,a?"_blank":"_self")}},"[data-href]"),dna.events.runOnLoads()}},dna.core={inject:function(e,v,y,C){function w(e){var n=dna.util.value(v,e);return null!=n}function a(e,n){var a,t,d,o,r,i,l,s,u,c,p,f,m,h,g=(n=$(n)).data().dnaRules;g.transform&&dna.util.apply(g.transform,v),g.loop&&(a=n,t=g.loop,d=dna.util.value(v,t.field),o=a.children("."+t.name.replace(/[.]/g,"\\.")),d?d.length===o.length?o.each(function(e,n){(n=$(n)).is("option")||dna.core.inject(n,d[e],e+1,C)}):(o.remove(),dna.clone(t.name,d,{container:a,html:C.html})):v[t.field]=[]),g.text&&(i=(r=n).data().dnaField,{string:!0,number:!0,boolean:!0}[typeof(l="[count]"===i?y:"[value]"===i?v:dna.util.value(v,i))]&&(r=C.html?r.html(l):r.text(l))),g.val&&(u=(s=n).data().dnaField,null!==(c="[count]"===u?y:"[value]"===u?v:dna.util.value(v,u))&&c!==s.val()&&s.val(c)),g.props&&function(e,n){for(var a=0;a<n.length/2;a++)e.prop(n[2*a],dna.util.realTruth(dna.util.value(v,n[2*a+1])))}(n,g.props),g.attrs&&function(e,n){for(var a=0;a<n.length/2;a++){var t=n[2*a],d=n[2*a+1],o=d[1],r=1===o?y:2===o?v:dna.util.value(v,o),i=[d[0],r,d[2]].join("");e.attr(t,i),/^data-./.test(t)&&e.data(t.substring(5),i),"value"===t&&i!==e.val()&&e.val(i)}}(n,g.attrs),g.class&&(p=n,f=g.class,m=dna.util.value(v,f[0]),h=dna.util.realTruth(m),1===f.length?p.addClass(m):1<f.length&&(p.toggleClass(f[1],h),f[2]&&p.toggleClass(f[2],!h))),g.require&&n.toggle(w(g.require)),g.missing&&n.toggle(!w(g.missing)),g.true&&n.toggle(dna.util.realTruth(dna.util.value(v,g.true))),g.false&&n.toggle(!dna.util.realTruth(dna.util.value(v,g.false))),g.callback&&dna.util.apply(g.callback,n)}return C.transform&&C.transform(v),function e(n){n.filter(".dna-nucleotide").each(a),n.length&&e(n.children().not(".dna-sub-clone"))}(e),e.data().dnaModel=v,e.data().dnaCount=y,e},replicate:function(e,n,a,t){var d=".dna-contains-"+e.name.replace(/[.]/g,"\\."),o=t.container?t.container.find(d).addBack(d):e.container,r=e.elem.clone(!0,!0),i=o.data().dnaCountsMap;i||(i=o.data().dnaCountsMap={});var l,s,u,c,p,f,m=r.data().dnaRules.template,h=i[m]?++i[m]:i[m]=1;return dna.core.inject(r,n,h,t),e.wrapped?t.top?o.prepend(r):o.append(r):(c=o.children(".dna-clone"),(p=c.filter("."+e.name)).length?t.top?p.first().before(r):p.last().after(r):(l=o.data().dnaContents,s=l.indexOf(e.name),(u=o.children().eq(s+l.reduce(function(e,n){return e+(n&&l.indexOf(n)<s?c.filter("."+n).length-1:0)},0))).length?u.before(r):o.append(r))),e.separators&&((f=o.children("."+e.name)).find(".dna-separator").show().end().last().find(".dna-separator").hide(),f.find(".dna-last-separator").hide().end().eq(-2).find(".dna-last-separator").show().closest(".dna-clone").find(".dna-separator").hide()),dna.events.runInitializers(r,n),t.callback&&t.callback(r,n),t.fade&&dna.ui.slideFadeIn(r),r},remove:function(e){return e.remove(),dna.placeholder.setup(),e},berserk:function(e){throw new Error("dna.js -> "+e)},plugin:function(){$.fn.dna=function(e){var a=[arguments[1],arguments[2],arguments[3]],t=dna[dna.util.toCamel(e)];return t||dna.core.berserk("Unknown plugin action: "+e),this.each(function(e,n){t($(n),a[0],a[1],a[2])})}},initModule:function(e,n){return window=e,$=n,(window.dna=dna).core.setup(),dna},setup:function(){dna.core.plugin(),$(dna.placeholder.setup),$(dna.panels.setup),$(dna.events.setup)}},"object"==typeof module?module.exports=dna.core.initModule:dna.core.setup();